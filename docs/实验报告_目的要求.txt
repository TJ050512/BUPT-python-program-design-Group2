一、项目目的
1) 构建高复杂度教务逻辑引擎
   - 时间片冲突检测：解析“周X节次”到时间片集合，集合交集判定冲突，自动拦截。
   - 名额与跨专业管控：触发器实时监控 current_students 与 cross_major_quota，满额或超额即拒绝。
   - GPA 自动计算：百分制→等级制(A-F)→4.0 绩点，加权公式 Σ(绩点×学分)/Σ学分。
2) 实践企业级分层架构
   - 分层：GUI 表现层 / 业务层（User/Course/Enrollment/Grade Manager）/ 数据层（Database/DAO）。
   - DTO：dataclasses 定义 Student/Teacher/Course/Offering/Enrollment/Grade，to_dict/from_dict 统一传输。
   - DAO 封装：execute_query/insert/update/delete 参数化查询，业务与存储解耦。
3) 数据库业务完整性
   - CHECK 约束：学号/工号/学院码格式 GLOB 校验。
   - 触发器：公选课仅晚间（trg_public_only_evening_bi）；跨专业限额（trg_cross_major_quota_bi）；ID 格式守护。
   - 外键约束：students/teachers/courses/offerings/enrollments/grades 等全链路参照完整性。
4) 全链路数据仿真与分析
   - data_simulator 自动生成学院、专业、培养方案、开课、选课、成绩等全套数据。
   - 成绩可视化：柱状图、饼图；统计均值/最高/最低/及格率。
5) 基于角色的安全访问（RBAC）
   - 权限装饰器 @require_permission 实现 AOP 式拦截，权限配置 JSON 可动态加载。
   - 密码安全：bcrypt 加盐哈希 + verify 校验。
   - 日志与审计：分级日志、轮转存储，记录操作人/时间/行为/IP。

二、项目要求
(一) 功能性要求
1) 核心教务逻辑
   - 智能冲突检测：时间片解析 + 交集检查；公选课仅晚间触发器强制。
   - 多维风控：时间冲突、重复修读、跨专业名额满额拦截；满员自动切换 full 状态。
   - 动态培养方案：program_courses/curriculum_matrix 支持学院-专业-年级-学期课程矩阵。
2) 学生端
   - 可视化课表：解析节次生成网格视图。
   - 实时选课：模糊检索课程、即时反馈名额与结果；退课校验“已录成绩不可退”。
   - 学业追踪：展示成绩、等级、绩点；自动计算学期 GPA。
3) 教师端
   - 班级与名单：按学期查看授课课程与学生名单。
   - 成绩全生命周期：录入/修改成绩，自动算等级与绩点，更新选课状态。
   - 教学分析：均值/最高/最低/及格率，成绩分布柱状图与饼图。
4) 管理员端
   - 一键仿真：批量生成学院/师生/开课/选课/成绩数据。
   - 账户与权限：学生、教师、管理员 CRUD，RBAC 权限管控。
   - 系统审计：关键操作日志持久化，含用户、时间、行为、IP。
(二) 技术性要求
1) 架构与模式
   - 三层架构，Manager 职责清晰；DAO 参数化查询。
   - 单例：数据库连接、配置加载。
   - 装饰器：@require_permission 实现权限切面。
2) 数据库与约束
   - 13 张核心表，外键维护参照完整性。
   - CHECK 约束校验 ID 格式；触发器保障业务规则（晚间公选、跨专业限额、ID 守护）。
3) 模型与类型安全
   - dataclasses DTO + to_dict/from_dict；广泛类型注解提升可读性与健壮性。
4) 安全与可观测
   - bcrypt 密码哈希，拒绝明文。
   - 分级日志 + 轮转；关键操作全量记录。
5) 网络与并发
   - 自定义 TCP 协议：4 字节长度前缀 + JSON，解决粘包/半包。
   - 线程模型：Thread-per-Client，Lock 保护客户端连接池。
   - 客户端生命周期：connect/send_request/disconnect，超时与异常友好处理。

三、系统设计（补充）
1) 架构概览
   - GUI：LoginWindow、StudentWindow、TeacherWindow，CustomTkinter 主题化 UI。
   - 业务：User/Course/Enrollment/Grade Manager 职责单一、接口清晰。
   - 数据：Database + DatabaseInterface 抽象，参数化 SQL，事务支持。
2) 数据库关键表
   - students/teachers/admins：人员与认证信息，ID GLOB 校验，密码哈希存储。
   - courses/course_offerings/offering_sessions：课程、开课计划、节次与教室绑定。
   - enrollments/grades：选课与成绩；enrollment 唯一约束(student_id, offering_id)。
   - colleges/majors/program_courses/curriculum_matrix：学院、专业、培养方案矩阵。
   - time_slots/classrooms：节次与教室，触发器防止冲突与违规排课。
   - system_logs：操作审计表，记录用户、时间、动作、IP。
3) 触发器与约束
   - trg_public_only_evening_bi：公选课排课限定晚间。
   - trg_cross_major_quota_bi：跨专业选课名额上限控制。
   - _students_fmt_guard/_teachers_fmt_guard：ID 格式守护。
4) 权限与安全
   - config/permissions.json 定义角色-权限；PermissionManager 运行时加载。
   - @require_permission 装饰器切面拦截敏感操作。
   - CryptoUtil bcrypt 加盐哈希 + verify，拒绝明文密码。
5) 网络协议
   - Protocol.encode/decode：4 字节长度前缀 + JSON，TLV 变种；状态码 success/error/unauthorized。
   - Server：thread-per-client 并发，Lock 保护 clients 字典，精确接收 _recv_exact。
   - Client：同步请求-响应，超时与异常处理，生命周期 connect/send/disconnect。
6) 日志与配置
   - Logger：RotatingFileHandler，10MB×5 轮转；格式含时间、级别、文件、行号。
   - Config：YAML 配置（config.yaml），单例加载，集中管理路径、网络、日志、缓存等参数。

四、功能实现（补充）
1) 选课逻辑（EnrollmentManager）
   - 课程状态校验：是否存在、是否 open、是否满员。
   - 重复/同课校验：防止同一课程重复或跨教师重复修读。
   - 时间冲突：时间片解析 + 交集检测，仅检查当前学期。
   - 退课逻辑：已录成绩不可退；退课后人数减一，满员课程恢复 open。
2) 成绩逻辑（GradeManager）
   - 录入/更新：成绩范围校验；映射等级与 GPA；更新 enrollment 状态 completed。
   - 查询：按学生、按课程获取成绩，含等级、绩点、学分。
3) 课程管理（CourseManager）
   - 课程检索：按代码/名称模糊搜索，按类型筛选；开课计划联表查询教师、时间、教室。
4) 数据仿真（data_simulator）
   - 生成学院/专业/课程池、开课计划、选课与成绩；支持 CSV 导入导出；支持按 base_semester 批量生成 8 学期数据。
5) GUI 特色
   - 主题：北邮蓝配色，居中大窗体；学生端/教师端分角色界面。
   - 组件：课程列表、课表视图、成绩表格、可视化图表嵌入（TeacherWindow 使用 matplotlib）。

五、技术亮点
1) DB 侧硬约束 + 触发器落地业务规则，防止绕过应用层。
2) AOP 权限装饰器 + JSON 配置，权限可热更新，代码解耦。
3) 自定义 TCP 协议 + 长度前缀，解决粘包/半包，简化跨语言对接。
4) dataclasses + 类型注解，统一数据出口/入口，降低维护成本。
5) 自动化数据仿真，支持大规模演示与压测；成绩可视化直观呈现教学质量。

六、测试与验证（摘要）
1) 功能测试：登录、选课/退课、成绩录入/修改、课表展示、数据分析图表。
2) 约束验证：公选课非晚间排课被触发器拦截；跨专业超额被拒；学号/工号格式错误被拒。
3) 并发与网络：多客户端连接，长度前缀协议无粘包；异常断开可恢复。
4) 安全：bcrypt 验证通过/错误用例；权限不足操作被拒，日志可追溯。

七、可扩展与改进
1) 课表可视化增强：周视图/冲突高亮。
2) 导入导出：Excel 批量导入课程/成绩；成绩单导出 PDF。
3) 通知与消息：选课结果、成绩更新的消息推送。
4) 历史审计：成绩修改历史表；更细粒度的操作审计。
5) 性能优化：常用查询缓存；异步 I/O；读写分离（如迁移到 MySQL/PostgreSQL）。
